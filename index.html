<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <title>Nametag Generator (STL One-piece)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- ใช้ฟอนต์ Noto Sans Thai และ CSS ใหม่ -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap">
    <link rel="stylesheet" href="./style-noto.css">
    <!-- FontAwesome สำหรับไอคอน -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.js"></script>
</head>

<body>
    <aside>
        <h1>Nametag Generator by Ranchana</h1>
        <div class="row" style="margin-bottom:16px;">
            <button id="add" class="btn secondary">Add</button>
            <button id="exportSTL" class="btn" style="margin-left:8px;">Export STL</button>
        </div>

        <fieldset>
            <legend>ข้อความ & ฟอนต์</legend>
            <label>ชื่อ (TEXT)</label>
            <input id="text" type="text" value="Ranchana" />
            <label>เลือกฟอนต์จากคลัง</label>
            <select id="fontSelect">
                <option value="">-- เลือกฟอนต์ --</option>
            </select>
            <label>หรืออัพโหลดฟอนต์เอง (.ttf/.otf)</label>
            <input id="font" type="file" accept=".ttf,.otf" />
            <div class="muted">เลือกจาก dropdown หรืออัพโหลดฟอนต์ของคุณเอง</div>
        </fieldset>
        <fieldset>
            <legend>เพิ่ม PNG ขาวดำ</legend>
            <label>PNG ขาวดำ</label>
            <input id="pngUpload" type="file" accept=".png" />
            <label>Extrude Depth (mm)</label>
            <input id="pngExtrudeDepth" type="number" value="2" step="0.1" />
            <label>ขนาดจริง (mm)</label>
            <input type="number" id="pngTargetWidth" value="50" min="1" step="0.1" placeholder="ขนาดจริง (mm)" />
            <button id="addPngExtrude" class="btn secondary">เพิ่ม PNG ขาวดำ (ขนาด mm เท่าจริง)</button>
            <div class="muted">อัปโหลด PNG ขาวดำเพื่อเพิ่มเป็นเลเยอร์ 3D โดยกำหนดขนาดจริง (mm)</div>
        </fieldset>
        <fieldset style="display:none;">
            <legend>เพิ่ม SVG</legend>
            <label>SVG</label>
            <input id="svgUpload" type="file" accept=".svg" />
            <label>Extrude Depth (mm)</label>
            <input id="svgExtrudeDepth" type="number" value="2" step="0.1" />
            <button id="addSvgExtrude" class="btn secondary">Add SVG Extrude</button>
            <div class="muted">อัปโหลด SVG เพื่อเพิ่มรูปร่าง 3D ที่แม่นยำ</div>
        </fieldset>
        <fieldset>
            <legend>Style</legend>
            <label>สไตล์</label>
            <select id="style">
                <option value="raised">Raised text (นูน)</option>
                <option value="cutout">Cutout text (เจาะ)</option>
            </select>


        </fieldset>

        <fieldset id="sizeSectionRaised">
            <legend>ขนาดหลัก</legend>
            <div class="row">
                <div>
                    <label>ความสูงตัวอักษร (mm)</label>
                    <input id="letterHeight" type="number" value="1.0" step="0.1" />
                </div>
                <div>
                    <label>ความหนาฐาน (mm)</label>
                    <input id="baseHeight" type="number" value="2.0" step="0.1" />
                </div>
            </div>
            <label>ระยะขอบฐานรอบตัวอักษร (outline, mm)</label>
            <input id="outline" type="number" value="4.0" step="0.1" />
            <label>สเกล mm ต่อหน่วยฟอนต์ (MM_PER_UNIT)</label>
            <input id="mmPerUnit" type="number" value="0.25" step="0.01" />
            <label>ความกว้างรวม (mm) - เว้นว่างถ้าไม่สเกล</label>
            <input id="totalWidth" type="number" placeholder="เช่น 100" step="0.1" />
            <label>ความสูงรวม (mm) - เว้นว่างถ้าไม่สเกล</label>
            <input id="totalHeight" type="number" value="13" step="0.1" />
            <div class="row">
                <div>
                    <label>ระยะห่างระหว่างตัวอักษร (mm)</label>
                    <input id="letterSpacing" type="number" step="0.1" value="0" />
                </div>
                <div>
                    <label>ความหนาตัวอักษร (mm)</label>
                    <input id="textStroke" type="number" value="0" step="0.1" />
                </div>
            </div>
        </fieldset>
        <!-- <fieldset id="sizeSectionRaised" data-style="raised">
            
</fieldset> -->
        <fieldset id="sizeSectionCutout" data-style="cutout">
            <legend>ขนาดสไตล์ Cutout</legend>
            <label>รัศมีมุมกรอบ (mm)</label>
            <input id="cornerRadius" type="number" value="6.0" step="0.1" />
            <div class="muted">ขอบ/ระยะรอบข้อความ ใช้ค่าจาก “ระยะขอบฐานรอบตัวอักษร (outline)” ด้านบน</div>
        </fieldset>

        <fieldset>
            <div class="row">
                <div>
                    <label>สีฐาน</label>
                    <input id="baseColor" type="color" value="#ffffff" style="width:110px;height:35px;" />
                </div>
                <div>
                    <label>สีตัวอักษร</label>
                    <input id="textColor" type="color" value="#222222" style="width:110px;height:35px;" />
                </div>
            </div>
        </fieldset>

        <fieldset>

            <legend>รูแขวน</legend>

            <div class="row">
                <div>
                    <label>เปิด/ปิด</label>
                    <select id="earEnabled">
                        <option value="true" selected>เปิด</option>
                        <option value="false">ปิด</option>
                    </select>
                </div>

                <div>
                    <label>ด้าน</label>
                    <select id="earSide">
                        <option value="left" selected>ซ้าย</option>
                        <option value="right">ขวา</option>
                    </select>
                </div>
            </div>
            <!-- <div class="row">
                    <div> -->
            <label>ตำแหน่งรู</label>
            <select id="earPlacement">
                <option value="side" selected>นอกกรอบ (หูด้านข้าง)</option>
                <option value="inside">ในกรอบ (เจาะภายใน)</option>
            </select>
            </div>
            </div>
            <div class="row">
                <div>
                    <label>รู (Ø, mm)</label>
                    <input id="holeDiameter" type="number" value="6.0" step="1" />
                </div>
                <div>
                    <label>เนื้อรอบรู (mm)</label>
                    <input id="earRingThickness" type="number" value="4.0" step="1" />
                </div>
            </div>
            <div class="row">
                <div>
                    <label>ซ้อนเข้าฐาน (mm)</label>
                    <input id="earAttachOverlap" type="number" value="2.0" step="1" />
                </div>
                <div>
                    <label>เลื่อนแกน Y (mm)</label>
                    <input id="earYShift" type="number" value="0.0" step="1" />
                </div>
            </div>
        </fieldset>

        <div class="row">
            <input id="layerName" type="text" placeholder="Layer name" style="width:120px;margin-right:8px;" />
            <button id="exportSTLByLayer" class="btn">Export STL (แยกเลเยอร์)</button>
            <button id="export3MF" class="btn" style="margin-top:8px;background:#696FC7;border:2px solid #A7AAE1;">
                <i class="fas fa-palette"></i> Export 3MF (Multi-Color)
            </button>
        </div>
        <div id="msg" class="muted" style="margin-top:8px"></div>
    </aside>

    <main style="position:relative;">
        <canvas id="view"></canvas>
        <div id="layer-list-panel" style="position:absolute;bottom:20px;right:20px;z-index:10;background:rgba(255,255,255,0.95);border-radius:16px;padding:16px;box-shadow:0 4px 16px rgba(105,111,199,0.15);backdrop-filter:blur(10px);min-width:240px;border:2px solid rgba(167,170,225,0.3);">
            <h3 style="margin-top:0;margin-bottom:12px;font-size:1.1em;color:#696FC7;font-weight:700;">Layers</h3>
            <div id="layer-list"></div>
            <div style="margin-top:10px;text-align:right;">
                <div id="dim-text" style="display:inline-block;background:linear-gradient(135deg, #696FC7, #A7AAE1);color:#fff;padding:8px 14px;border-radius:10px;font-size:13px;font-weight:600;box-shadow:0 2px 8px rgba(105,111,199,0.2);">--</div>
            </div>
        </div>
        <div id="viewport-controls" style="position:absolute;top:20px;right:20px;z-index:10;display:flex;gap:12px;background:rgba(255,255,255,0.95);padding:12px 16px;border-radius:16px;box-shadow:0 4px 16px rgba(105,111,199,0.15);backdrop-filter:blur(10px);">
            <button class="btn secondary" data-view="top" title="Top" style="padding:10px 18px;font-size:14px;min-width:70px;">Top</button>
            <button class="btn secondary" data-view="front" title="Front" style="padding:10px 18px;font-size:14px;min-width:70px;">Front</button>
            <button class="btn secondary" data-view="side" title="Side" style="padding:10px 18px;font-size:14px;min-width:70px;">Side</button>
            <button class="btn secondary" data-view="back" title="Back" style="padding:10px 18px;font-size:14px;min-width:70px;">Back</button>
            <button class="btn secondary" data-view="bottom" title="Bottom" style="padding:10px 18px;font-size:14px;min-width:70px;">Bottom</button>
        </div>
    </main>

    <!-- libs แบบ UMD -->
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipper-lib@6.4.2/clipper.js"></script>

    <!-- แอพหลัก (ESM) -->
    <script type="module" src="./ui-app.js"></script>
</body>

</html>